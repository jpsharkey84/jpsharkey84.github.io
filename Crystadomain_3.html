<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BEACONS | System OS v1.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #94b0da;
            --accent: #ff9d00;
            --bg: #050a14;
            --panel-alpha: rgba(10, 20, 35, 0.9);
        }

        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg); font-family: 'JetBrains Mono', monospace; }
        
        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

        /* CORE SYSTEM HUD */
        #hud {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10;
            pointer-events: none;
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            grid-template-rows: 1fr 200px;
            padding: 30px;
            box-sizing: border-box;
        }

        .panel {
            pointer-events: auto;
            background: var(--panel-alpha);
            border: 1px solid rgba(148, 176, 218, 0.3);
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            backdrop-filter: blur(12px);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        /* DIRECTORY PANEL */
        .directory { grid-column: 1; grid-row: 1; }
        .directory h2 { font-size: 14px; color: var(--primary); margin: 0 0 20px 0; border-bottom: 1px solid var(--primary); padding-bottom: 10px; }
        .nav-link { color: #fff; text-decoration: none; font-size: 12px; margin: 8px 0; display: flex; align-items: center; cursor: pointer; opacity: 0.7; transition: 0.2s; }
        .nav-link:hover { opacity: 1; transform: translateX(5px); color: var(--accent); }
        .nav-link::before { content: '>'; margin-right: 10px; color: var(--accent); }

        /* DATA MONITOR */
        .monitor { grid-column: 3; grid-row: 1; text-align: right; }
        .stat-row { margin-bottom: 15px; }
        .stat-label { font-size: 10px; color: var(--primary); display: block; }
        .stat-value { font-size: 18px; color: #fff; font-weight: 500; }

        /* SYSTEM COMMAND TERMINAL */
        .terminal {
            grid-column: 1 / span 3;
            grid-row: 2;
            margin-top: 20px;
            border-top: 2px solid var(--accent);
            position: relative;
        }
        #output { flex: 1; font-size: 12px; color: #8899aa; overflow-y: auto; margin-bottom: 10px; }
        .input-line { display: flex; align-items: center; border-top: 1px solid rgba(148, 176, 218, 0.1); padding-top: 10px; }
        .prompt { color: var(--accent); margin-right: 10px; }
        input { background: transparent; border: none; color: #fff; font-family: 'JetBrains Mono'; font-size: 14px; width: 100%; outline: none; }

        /* SCANLINE EFFECT */
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 4px, 3px 100%;
            pointer-events: none; z-index: 100;
        }
    </style>
</head>
<body>

<div id="overlay"></div>
<div id="canvas-container"></div>

<div id="hud">
    <div class="panel directory">
        <h2>DOMAIN_INDEX</h2>
        <div class="nav-link" onclick="sys.focus('logs')">RECORDS / LOGS</div>
        <div class="nav-link" onclick="sys.focus('backpack')">RESOURCE / BACKPACK</div>
        <div class="nav-link" onclick="sys.focus('money')">VALUATION / LEDGER</div>
        <div class="nav-link" onclick="sys.focus('flow')">METRICS / FLOW</div>
    </div>

    <div class="panel monitor">
        <div class="stat-row">
            <span class="stat-label">COORDINATE_Z</span>
            <span id="stat-z" class="stat-value">00.00</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">SYSTEM_MOOD</span>
            <span id="stat-mood" class="stat-value" style="color: var(--accent);">ORANGE_FLOW</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">SESSION_TIME</span>
            <span id="stat-time" class="stat-value">00:00:00</span>
        </div>
    </div>

    <div class="panel terminal">
        <div id="output">
            [SYS] BEACONS BOOT SEQUENCE COMPLETE...<br>
            [SYS] SPATIAL DOMAIN LOADED: 14 NODES ACTIVE.<br>
            [SYS] AWAITING COMMAND_
        </div>
        <div class="input-line">
            <span class="prompt">SYSTEM@DOMAIN_ROOT:~$</span>
            <input type="text" id="cmd-input" autofocus autocomplete="off">
        </div>
    </div>
</div>

<script>
/**
 * SYSTEM KERNEL
 * Handles state, data logic, and terminal commands
 */
class BeaconsSystem {
    constructor() {
        this.state = {
            mood: 'ORANGE_FLOW',
            position: { x: 0, z: 0 },
            logs: [],
            money: 1000,
            startTime: Date.now()
        };
        this.initTerminal();
        this.updateClock();
    }

    initTerminal() {
        const input = document.getElementById('cmd-input');
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                this.execute(input.value);
                input.value = '';
            }
        });
    }

    log(msg, type = 'SYS') {
        const out = document.getElementById('output');
        out.innerHTML += `<br>[${type}] ${msg}`;
        out.scrollTop = out.scrollHeight;
    }

    execute(cmd) {
        const parts = cmd.toLowerCase().split(' ');
        const action = parts[0];

        switch(action) {
            case 'log':
                const entry = cmd.substring(4);
                this.state.logs.push(entry);
                this.log(`RECORDED: "${entry}"`, 'DATA');
                engine.spawnSpire(this.state.position.z - 50);
                break;
            case 'mood':
                this.state.mood = parts[1]?.toUpperCase() || 'STABLE';
                document.getElementById('stat-mood').innerText = this.state.mood;
                this.log(`ENVIRONMENT SHIFT: ${this.state.mood}`);
                break;
            case 'clear':
                document.getElementById('output').innerHTML = '[SYS] TERMINAL_CLEARED';
                break;
            default:
                this.log(`UNKNOWN COMMAND: ${action}`, 'ERR');
        }
    }

    updateClock() {
        setInterval(() => {
            const elapsed = Math.floor((Date.now() - this.state.startTime) / 1000);
            const s = (elapsed % 60).toString().padStart(2, '0');
            const m = Math.floor(elapsed / 60 % 60).toString().padStart(2, '0');
            const h = Math.floor(elapsed / 3600).toString().padStart(2, '0');
            document.getElementById('stat-time').innerText = `${h}:${m}:${s}`;
        }, 1000);
    }
}

/**
 * SPATIAL ENGINE
 * Handles the 3D rendering and environmental layers
 */
class SpatialEngine {
    constructor() {
        this.container = document.getElementById('canvas-container');
        this.scene = new THREE.Scene();
        this.scene.fog = new THREE.FogExp2(0x0a1423, 0.008);
        
        this.camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 2000);
        this.renderer = new THREE.WebGLRenderer({ antialias: true });
        this.renderer.setSize(window.innerWidth, window.innerHeight);
        this.renderer.setPixelRatio(window.devicePixelRatio);
        this.container.appendChild(this.renderer.domElement);

        this.initLights();
        this.initEnvironment();
        this.spires = [];
        this.animate();
    }

    initLights() {
        const ambient = new THREE.AmbientLight(0x404040, 0.5);
        this.scene.add(ambient);

        this.sun = new THREE.DirectionalLight(0xff9d00, 1.5);
        this.sun.position.set(0, 50, -100);
        this.scene.add(this.sun);
    }

    initEnvironment() {
        // The Crystal Grid Path
        const gridGeom = new THREE.PlaneGeometry(40, 2000, 20, 100);
        const gridMat = new THREE.MeshPhongMaterial({
            color: 0x94b0da,
            wireframe: true,
            transparent: true,
            opacity: 0.15
        });
        this.path = new THREE.Mesh(gridGeom, gridMat);
        this.path.rotation.x = -Math.PI / 2;
        this.scene.add(this.path);

        // Initial Spires
        for(let i = 0; i < 15; i++) {
            this.spawnSpire(-i * 80 + (Math.random() * 20));
        }
    }

    spawnSpire(z) {
        const height = 40 + Math.random() * 60;
        const geom = new THREE.CylinderGeometry(0, 4, height, 4);
        const mat = new THREE.MeshPhongMaterial({
            color: 0xffffff,
            emissive: 0x4a6fa5,
            emissiveIntensity: 0.5,
            transparent: true,
            opacity: 0.7,
            flatShading: true
        });
        const spire = new THREE.Mesh(geom, mat);
        const side = Math.random() > 0.5 ? 30 : -30;
        spire.position.set(side, height/2, z);
        this.scene.add(spire);
        this.spires.push(spire);
    }

    animate() {
        requestAnimationFrame(() => this.animate());
        
        // Auto-walk or move with keys
        if (keys['KeyW']) this.camera.position.z -= 1.0;
        if (keys['KeyS']) this.camera.position.z += 1.0;

        document.getElementById('stat-z').innerText = Math.abs(this.camera.position.z).toFixed(2);
        
        this.renderer.render(this.scene, this.camera);
    }
}

// Global System Boot
const keys = {};
window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

const sys = new BeaconsSystem();
const engine = new SpatialEngine();

window.addEventListener('resize', () => {
    engine.camera.aspect = window.innerWidth / window.innerHeight;
    engine.camera.updateProjectionMatrix();
    engine.renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
